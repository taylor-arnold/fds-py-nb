<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>notebook04a – Foundations of Data Science: Notebooks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8b99633e97494cb736d7188ebc41eb6d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar docked fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./notebook04a.html">Notebook04a</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Foundations of Data Science: Notebooks</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook01a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook01a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook01b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook01b</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook02a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook02a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook02b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook02b</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook02c.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook02c</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook02d.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook02d</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook03a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook03a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook03b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook03b</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook03c.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook03c</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook03d.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook03d</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook03e.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook03e</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook04a.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Notebook04a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook04b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook04b</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook04c.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook04c</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook05a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook05a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook05b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook05b</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook06a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook06a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook06b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook06b</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook07a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook07a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook07b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook07b</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook08a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook08a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook08b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook08b</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook09a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook09a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook09b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook09b</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook10a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook10a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook10b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook10b</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook11a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook11a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook11b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook11b</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook12a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook12a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook12b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook12b</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook13a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook13a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook13b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook13b</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook14a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook14a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook14b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook14b</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook15a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook15a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook15b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook15b</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook16a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook16a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook16b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook16b</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook17a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook17a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook17b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook17b</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook18a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook18a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook18b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook18b</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook19a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook19a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook19b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook19b</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook20a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook20a</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notebook20b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook20b</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Notebook04a</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="setup" class="level3">
<h3 class="anchored" data-anchor-id="setup">Setup</h3>
<p>Run all of the following before starting the notebook.</p>
<div id="6a007292" class="cell" data-tags="[&quot;noclear&quot;]" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span> wget <span class="op">-</span>q <span class="op">-</span>nc https:<span class="op">//</span>raw.githubusercontent.com<span class="op">/</span>taylor<span class="op">-</span>arnold<span class="op">/</span>fds<span class="op">-</span>py<span class="op">/</span>refs<span class="op">/</span>heads<span class="op">/</span>main<span class="op">/</span>funs.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="98f10f36" class="cell" data-tags="[&quot;noclear&quot;]" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> funs <span class="im">import</span> <span class="op">*</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> polars <span class="im">import</span> col <span class="im">as</span> c</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>theme_set(theme_minimal())</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>ub <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/taylor-arnold/fds-py-nb/refs/heads/main/"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="aa74c6b3" class="cell" data-tags="[&quot;noclear&quot;]" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>movie <span class="op">=</span> pl.read_csv(ub <span class="op">+</span> <span class="st">"data/movies_50_years.csv"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> pl.read_csv(ub <span class="op">+</span> <span class="st">"data/movies_50_years_color.csv"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>genre <span class="op">=</span> pl.read_csv(ub <span class="op">+</span> <span class="st">"data/movies_50_years_genre.csv"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>people <span class="op">=</span> pl.read_csv(ub <span class="op">+</span> <span class="st">"data/movies_50_years_people.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="questions" class="level3">
<h3 class="anchored" data-anchor-id="questions">Questions</h3>
<p>In this notebook, we will learn how to combine information from multiple datasets using joins. The movie data has been split into several tables: <code>movie</code> contains basic information about each film (runtime, rating, etc.), <code>genre</code> lists the genres associated with each film, <code>color</code> contains information about the colors in each movie’s poster, and <code>people</code> has information about the cast and crew. Because some movie titles are duplicated across different years, we will always join by both year and title to ensure we match records correctly.</p>
<p>Create a new column in the <code>movie</code> dataset that computes the ratio of the number of ratings to the runtime. This gives a rough sense of audience engagement per minute of film.</p>
<div id="c073dcf9" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    movie</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        ratings_per_minute <span class="op">=</span> c.rating_count <span class="op">/</span> c.runtime</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5_000, 13)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">mpa</th>
<th data-quarto-table-cell-role="th">runtime</th>
<th data-quarto-table-cell-role="th">gross</th>
<th data-quarto-table-cell-role="th">rating_count</th>
<th data-quarto-table-cell-role="th">rating</th>
<th data-quarto-table-cell-role="th">metacritic</th>
<th data-quarto-table-cell-role="th">poster_brightness</th>
<th data-quarto-table-cell-role="th">poster_saturation</th>
<th data-quarto-table-cell-role="th">poster_edgeness</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">ratings_per_minute</th>
</tr>
<tr class="even">
<th>i64</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>f64</th>
<th>i64</th>
<th>f64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>str</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1970</td>
<td>"Love Story"</td>
<td>"PG"</td>
<td>100</td>
<td>106.4</td>
<td>28330</td>
<td>6.9</td>
<td>null</td>
<td>79.039734</td>
<td>8.029792</td>
<td>4.586166</td>
<td>"A boy and a girl from differen…</td>
<td>283.3</td>
</tr>
<tr class="even">
<td>1970</td>
<td>"Airport"</td>
<td>"G"</td>
<td>137</td>
<td>100.49</td>
<td>16512</td>
<td>6.6</td>
<td>42</td>
<td>70.73516</td>
<td>29.284572</td>
<td>4.954735</td>
<td>"A bomber on board an airplane,…</td>
<td>120.525547</td>
</tr>
<tr class="odd">
<td>1970</td>
<td>"MASH"</td>
<td>"R"</td>
<td>116</td>
<td>81.6</td>
<td>64989</td>
<td>7.5</td>
<td>null</td>
<td>74.540002</td>
<td>40.103629</td>
<td>3.510285</td>
<td>"The staff of a Korean War fiel…</td>
<td>560.25</td>
</tr>
<tr class="even">
<td>1970</td>
<td>"Patton"</td>
<td>"GP"</td>
<td>172</td>
<td>61.7</td>
<td>90461</td>
<td>7.9</td>
<td>null</td>
<td>83.128991</td>
<td>17.43385</td>
<td>3.657574</td>
<td>"The World War II phase of the …</td>
<td>525.936047</td>
</tr>
<tr class="odd">
<td>1970</td>
<td>"The AristoCats"</td>
<td>"G"</td>
<td>78</td>
<td>37.68</td>
<td>87551</td>
<td>7.1</td>
<td>null</td>
<td>79.794746</td>
<td>12.481992</td>
<td>4.400358</td>
<td>"With the help of a smooth talk…</td>
<td>1122.448718</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2019</td>
<td>"The Art of Self-Defense"</td>
<td>"R"</td>
<td>104</td>
<td>2.41</td>
<td>18474</td>
<td>6.7</td>
<td>null</td>
<td>45.466534</td>
<td>67.429893</td>
<td>3.232832</td>
<td>"After being attacked on the st…</td>
<td>177.634615</td>
</tr>
<tr class="even">
<td>2019</td>
<td>"Luce"</td>
<td>"R"</td>
<td>109</td>
<td>1.78</td>
<td>5800</td>
<td>6.8</td>
<td>null</td>
<td>76.585779</td>
<td>5.941685</td>
<td>2.307601</td>
<td>"A married couple is forced to …</td>
<td>53.211009</td>
</tr>
<tr class="odd">
<td>2019</td>
<td>"The Other Side of Heaven 2: Fi…</td>
<td>"PG-13"</td>
<td>117</td>
<td>1.72</td>
<td>259</td>
<td>5.1</td>
<td>null</td>
<td>57.68667</td>
<td>39.572749</td>
<td>2.307937</td>
<td>"Missionary John H. Groberg ret…</td>
<td>2.213675</td>
</tr>
<tr class="even">
<td>2019</td>
<td>"The Aftermath"</td>
<td>"R"</td>
<td>108</td>
<td>1.62</td>
<td>13203</td>
<td>6.3</td>
<td>43</td>
<td>18.4582</td>
<td>36.364627</td>
<td>2.137566</td>
<td>"Post World War II, a British c…</td>
<td>122.25</td>
</tr>
<tr class="odd">
<td>2019</td>
<td>"The Kid"</td>
<td>"R"</td>
<td>100</td>
<td>1.51</td>
<td>5210</td>
<td>5.9</td>
<td>51</td>
<td>27.409446</td>
<td>40.325301</td>
<td>3.192685</td>
<td>"The story of a young boy who w…</td>
<td>52.1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Using the <code>movie</code> dataset, create a scatter plot with runtime on the x-axis and the IMDB rating on the y-axis.</p>
<div id="e8d130de" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    movie</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot, aes(<span class="st">"runtime"</span>, <span class="st">"rating"</span>))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_point()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/admin/gh/fds-py-nb/.venv/lib/python3.13/site-packages/plotnine/layer.py:374: PlotnineWarning: geom_point : Removed 387 rows containing missing values.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>
<figure class="figure">
<p><a href="notebook04a_files/figure-html/cell-7-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="notebook04a_files/figure-html/cell-7-output-2.png" width="672" height="480" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Create a boxplot showing the distribution of poster brightness for each MPA rating category.</p>
<div id="f7e09bcd" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    movie</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot, aes(<span class="st">"mpa"</span>, <span class="st">"poster_brightness"</span>))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_boxplot()</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/admin/gh/fds-py-nb/.venv/lib/python3.13/site-packages/plotnine/layer.py:293: PlotnineWarning: stat_boxplot : Removed 461 rows containing non-finite values.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>
<figure class="figure">
<p><a href="notebook04a_files/figure-html/cell-8-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="notebook04a_files/figure-html/cell-8-output-2.png" width="672" height="480" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Now let’s start working with multiple tables. Join the <code>genre</code> table to the <code>movie</code> table. Remember to join on both year and title since some titles appear in multiple years.</p>
<div id="af39455c" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    genre</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    .join(movie, on<span class="op">=</span>[c.year, c.title])</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (11_887, 13)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">genre</th>
<th data-quarto-table-cell-role="th">mpa</th>
<th data-quarto-table-cell-role="th">runtime</th>
<th data-quarto-table-cell-role="th">gross</th>
<th data-quarto-table-cell-role="th">rating_count</th>
<th data-quarto-table-cell-role="th">rating</th>
<th data-quarto-table-cell-role="th">metacritic</th>
<th data-quarto-table-cell-role="th">poster_brightness</th>
<th data-quarto-table-cell-role="th">poster_saturation</th>
<th data-quarto-table-cell-role="th">poster_edgeness</th>
<th data-quarto-table-cell-role="th">description</th>
</tr>
<tr class="even">
<th>i64</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>f64</th>
<th>i64</th>
<th>f64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1970</td>
<td>"Love Story"</td>
<td>"Drama"</td>
<td>"PG"</td>
<td>100</td>
<td>106.4</td>
<td>28330</td>
<td>6.9</td>
<td>null</td>
<td>79.039734</td>
<td>8.029792</td>
<td>4.586166</td>
<td>"A boy and a girl from differen…</td>
</tr>
<tr class="even">
<td>1970</td>
<td>"Love Story"</td>
<td>"Romance"</td>
<td>"PG"</td>
<td>100</td>
<td>106.4</td>
<td>28330</td>
<td>6.9</td>
<td>null</td>
<td>79.039734</td>
<td>8.029792</td>
<td>4.586166</td>
<td>"A boy and a girl from differen…</td>
</tr>
<tr class="odd">
<td>1970</td>
<td>"Airport"</td>
<td>"Action"</td>
<td>"G"</td>
<td>137</td>
<td>100.49</td>
<td>16512</td>
<td>6.6</td>
<td>42</td>
<td>70.73516</td>
<td>29.284572</td>
<td>4.954735</td>
<td>"A bomber on board an airplane,…</td>
</tr>
<tr class="even">
<td>1970</td>
<td>"Airport"</td>
<td>"Drama"</td>
<td>"G"</td>
<td>137</td>
<td>100.49</td>
<td>16512</td>
<td>6.6</td>
<td>42</td>
<td>70.73516</td>
<td>29.284572</td>
<td>4.954735</td>
<td>"A bomber on board an airplane,…</td>
</tr>
<tr class="odd">
<td>1970</td>
<td>"Airport"</td>
<td>"Thriller"</td>
<td>"G"</td>
<td>137</td>
<td>100.49</td>
<td>16512</td>
<td>6.6</td>
<td>42</td>
<td>70.73516</td>
<td>29.284572</td>
<td>4.954735</td>
<td>"A bomber on board an airplane,…</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2019</td>
<td>"The Aftermath"</td>
<td>"Romance"</td>
<td>"R"</td>
<td>108</td>
<td>1.62</td>
<td>13203</td>
<td>6.3</td>
<td>43</td>
<td>18.4582</td>
<td>36.364627</td>
<td>2.137566</td>
<td>"Post World War II, a British c…</td>
</tr>
<tr class="even">
<td>2019</td>
<td>"The Aftermath"</td>
<td>"War"</td>
<td>"R"</td>
<td>108</td>
<td>1.62</td>
<td>13203</td>
<td>6.3</td>
<td>43</td>
<td>18.4582</td>
<td>36.364627</td>
<td>2.137566</td>
<td>"Post World War II, a British c…</td>
</tr>
<tr class="odd">
<td>2019</td>
<td>"The Kid"</td>
<td>"Biography"</td>
<td>"R"</td>
<td>100</td>
<td>1.51</td>
<td>5210</td>
<td>5.9</td>
<td>51</td>
<td>27.409446</td>
<td>40.325301</td>
<td>3.192685</td>
<td>"The story of a young boy who w…</td>
</tr>
<tr class="even">
<td>2019</td>
<td>"The Kid"</td>
<td>"Drama"</td>
<td>"R"</td>
<td>100</td>
<td>1.51</td>
<td>5210</td>
<td>5.9</td>
<td>51</td>
<td>27.409446</td>
<td>40.325301</td>
<td>3.192685</td>
<td>"The story of a young boy who w…</td>
</tr>
<tr class="odd">
<td>2019</td>
<td>"The Kid"</td>
<td>"Western"</td>
<td>"R"</td>
<td>100</td>
<td>1.51</td>
<td>5210</td>
<td>5.9</td>
<td>51</td>
<td>27.409446</td>
<td>40.325301</td>
<td>3.192685</td>
<td>"The story of a young boy who w…</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Using the joined data, compute the average poster brightness and average poster saturation for each genre. Then create a scatter plot of these averages with genre labels next to each point.</p>
<div id="9be8a6ef" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    genre</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    .join(movie, on<span class="op">=</span>[c.year, c.title])</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    .group_by(c.genre)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        poster_brightness_mean <span class="op">=</span> c.poster_brightness.mean(),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        poster_saturation <span class="op">=</span> c.poster_saturation.mean()</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot, aes(<span class="st">"poster_brightness_mean"</span>, <span class="st">"poster_saturation"</span>))</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_point()</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_text(aes(label<span class="op">=</span><span class="st">"genre"</span>), nudge_y<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>
<figure class="figure">
<p><a href="notebook04a_files/figure-html/cell-10-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="notebook04a_files/figure-html/cell-10-output-1.png" width="672" height="480" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>The <code>people</code> table contains information about cast and crew, including a predicted gender and a confidence score for that prediction. Filter the people data to only starring roles where the gender confidence is greater than 0.8. Then join this to the genre table. For each genre, compute the proportion of these roles that are female and the total count. Sort by the proportion of female roles and display all results.</p>
<div id="7b1546f4" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    people</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(c.role <span class="op">==</span> <span class="st">"starring"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(c.gender_conf <span class="op">&gt;</span> <span class="fl">0.8</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    .join(genre, on<span class="op">=</span>[c.year, c.title])</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    .group_by(c.genre)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        avg_female <span class="op">=</span> (c.gender <span class="op">==</span> <span class="st">"female"</span>).mean(),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> pl.count()</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    .sort(c.avg_female)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    .pipe(print_rows)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/5w/rxshd8hd6vv8mxsbj211mr_m0000gn/T/ipykernel_48472/3827170702.py:9: DeprecationWarning: `pl.count()` is deprecated. Please use `pl.len()` instead.
(Deprecated in version 0.20.5)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (21, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">genre</th>
<th data-quarto-table-cell-role="th">avg_female</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
<tr class="even">
<th>str</th>
<th>f64</th>
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Short"</td>
<td>0.0</td>
<td>1</td>
</tr>
<tr class="even">
<td>"War"</td>
<td>0.183099</td>
<td>213</td>
</tr>
<tr class="odd">
<td>"History"</td>
<td>0.233516</td>
<td>364</td>
</tr>
<tr class="even">
<td>"Western"</td>
<td>0.247059</td>
<td>255</td>
</tr>
<tr class="odd">
<td>"Action"</td>
<td>0.267078</td>
<td>4538</td>
</tr>
<tr class="even">
<td>"Crime"</td>
<td>0.284756</td>
<td>3129</td>
</tr>
<tr class="odd">
<td>"Adventure"</td>
<td>0.289352</td>
<td>3691</td>
</tr>
<tr class="even">
<td>"Sport"</td>
<td>0.293249</td>
<td>474</td>
</tr>
<tr class="odd">
<td>"Biography"</td>
<td>0.297017</td>
<td>771</td>
</tr>
<tr class="even">
<td>"Animation"</td>
<td>0.299799</td>
<td>994</td>
</tr>
<tr class="odd">
<td>"Sci-Fi"</td>
<td>0.308668</td>
<td>1419</td>
</tr>
<tr class="even">
<td>"Thriller"</td>
<td>0.331402</td>
<td>2589</td>
</tr>
<tr class="odd">
<td>"Comedy"</td>
<td>0.356179</td>
<td>7485</td>
</tr>
<tr class="even">
<td>"Fantasy"</td>
<td>0.35889</td>
<td>1513</td>
</tr>
<tr class="odd">
<td>"Drama"</td>
<td>0.359471</td>
<td>7945</td>
</tr>
<tr class="even">
<td>"Music"</td>
<td>0.364</td>
<td>500</td>
</tr>
<tr class="odd">
<td>"Family"</td>
<td>0.364198</td>
<td>1458</td>
</tr>
<tr class="even">
<td>"Mystery"</td>
<td>0.37883</td>
<td>1436</td>
</tr>
<tr class="odd">
<td>"Musical"</td>
<td>0.378995</td>
<td>219</td>
</tr>
<tr class="even">
<td>"Horror"</td>
<td>0.385405</td>
<td>1754</td>
</tr>
<tr class="odd">
<td>"Romance"</td>
<td>0.433153</td>
<td>2775</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Let’s find the most common dominant poster color for each genre. Start with the <code>color</code> table and filter to just the hue colors. For each movie, find the color with the highest percentage (this is the dominant hue). Keep only movies where the dominant hue makes up more than 5% of the poster. Join this to the genre table, then count how often each color appears as the dominant hue within each genre. Finally, find the single most common dominant color for each genre.</p>
<div id="caf6ca55" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    color</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(c.color_type <span class="op">==</span> <span class="st">"hue"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    .sort(c.percentage, descending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    .group_by(c.year, c.title)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    .head(<span class="dv">1</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(c.percentage <span class="op">&gt;</span> <span class="dv">5</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    .join(genre, on<span class="op">=</span>[c.year, c.title])</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    .group_by(c.genre, c.color)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    .agg(count <span class="op">=</span> pl.count())</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    .sort(c.count, descending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    .group_by(c.genre)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    .head(<span class="dv">1</span>)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    .pipe(print_rows)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/5w/rxshd8hd6vv8mxsbj211mr_m0000gn/T/ipykernel_48472/1500220528.py:10: DeprecationWarning: `pl.count()` is deprecated. Please use `pl.len()` instead.
(Deprecated in version 0.20.5)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (21, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">genre</th>
<th data-quarto-table-cell-role="th">color</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Music"</td>
<td>"red"</td>
<td>70</td>
</tr>
<tr class="even">
<td>"Western"</td>
<td>"red"</td>
<td>30</td>
</tr>
<tr class="odd">
<td>"Fantasy"</td>
<td>"red"</td>
<td>148</td>
</tr>
<tr class="even">
<td>"Biography"</td>
<td>"red"</td>
<td>84</td>
</tr>
<tr class="odd">
<td>"Animation"</td>
<td>"blue"</td>
<td>132</td>
</tr>
<tr class="even">
<td>"History"</td>
<td>"red"</td>
<td>39</td>
</tr>
<tr class="odd">
<td>"War"</td>
<td>"red"</td>
<td>28</td>
</tr>
<tr class="even">
<td>"Comedy"</td>
<td>"red"</td>
<td>1018</td>
</tr>
<tr class="odd">
<td>"Musical"</td>
<td>"red"</td>
<td>30</td>
</tr>
<tr class="even">
<td>"Crime"</td>
<td>"red"</td>
<td>432</td>
</tr>
<tr class="odd">
<td>"Short"</td>
<td>"red"</td>
<td>1</td>
</tr>
<tr class="even">
<td>"Horror"</td>
<td>"red"</td>
<td>160</td>
</tr>
<tr class="odd">
<td>"Family"</td>
<td>"red"</td>
<td>159</td>
</tr>
<tr class="even">
<td>"Action"</td>
<td>"red"</td>
<td>535</td>
</tr>
<tr class="odd">
<td>"Adventure"</td>
<td>"blue"</td>
<td>374</td>
</tr>
<tr class="even">
<td>"Sport"</td>
<td>"red"</td>
<td>69</td>
</tr>
<tr class="odd">
<td>"Drama"</td>
<td>"red"</td>
<td>971</td>
</tr>
<tr class="even">
<td>"Romance"</td>
<td>"red"</td>
<td>436</td>
</tr>
<tr class="odd">
<td>"Sci-Fi"</td>
<td>"blue"</td>
<td>155</td>
</tr>
<tr class="even">
<td>"Thriller"</td>
<td>"red"</td>
<td>294</td>
</tr>
<tr class="odd">
<td>"Mystery"</td>
<td>"red"</td>
<td>139</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Now, let’s see an example of how to use an semi-join. First, create a table called <code>movie_long</code> that consists of all films that have a run time greater than 2.5 hours (150 minutes).</p>
<div id="caf9d1cf" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>movie_long <span class="op">=</span> movie.<span class="bu">filter</span>(c.runtime <span class="op">&gt;</span> <span class="fl">2.5</span> <span class="op">*</span> <span class="dv">60</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, draw a plot showing the number films that have a long runtime by their genre using a semi-join. Try to make the plot look nice. Note: Yes, you could do this in other ways in this simple case. Semi- and anti-joins are very useful as our analyses become more complex.</p>
<div id="3e85fd1a" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    genre</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    .join(movie_long, on<span class="op">=</span>[c.year, c.title], how<span class="op">=</span><span class="st">"semi"</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    .group_by(c.genre)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    .agg(count <span class="op">=</span> pl.<span class="bu">len</span>())</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot, aes(<span class="st">"reorder(genre, count)"</span>, <span class="st">"count"</span>))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_col()</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> coord_flip()</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>
<figure class="figure">
<p><a href="notebook04a_files/figure-html/cell-14-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="notebook04a_files/figure-html/cell-14-output-1.png" width="672" height="480" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>We’ve mentioned that some titles are repeated in the data and therefore we always need to group by title and year. Find all of the titles that are repeated. Print all of the rows of the result and order by the counts.</p>
<div id="ea3dce97" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    movie</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    .group_by(c.title)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    .agg(count <span class="op">=</span> pl.<span class="bu">len</span>())</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(c.count <span class="op">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    .sort(c.count, descending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    .pipe(print_rows)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (92, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
<tr class="even">
<th>str</th>
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"The Adventures of Pinocchio"</td>
<td>3</td>
</tr>
<tr class="even">
<td>"Shaft"</td>
<td>3</td>
</tr>
<tr class="odd">
<td>"Robin Hood"</td>
<td>3</td>
</tr>
<tr class="even">
<td>"Hercules"</td>
<td>3</td>
</tr>
<tr class="odd">
<td>"Halloween"</td>
<td>3</td>
</tr>
<tr class="even">
<td>"Godzilla"</td>
<td>3</td>
</tr>
<tr class="odd">
<td>"Hairspray"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Twilight"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Threesome"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Sparkle"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Aladdin"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Scream"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Child's Play"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Hot Pursuit"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Annie"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Freaky Friday"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Overboard"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Grease 2"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"The Circle"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Clash of the Titans"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"The Karate Kid"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"The Hills Have Eyes"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"The Lion King"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"The Getaway"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"The Amityville Horror"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Bad Boys"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Death Wish"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"The Three Musketeers"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"The Stepford Wives"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Charlotte's Web"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"When a Stranger Calls"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"A Star Is Born"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Serenity"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"The Strangers"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"The Guardian"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Halloween II"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"The Jungle Book"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Poltergeist"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Going in Style"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Friday the 13th"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Total Recall"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Gone in 60 Seconds"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"RoboCop"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Grease"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"The Rookie"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Life"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"The Intruder"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Point Break"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Carrie"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"No Escape"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Pete's Dragon"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Neighbors"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Night School"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"The Avengers"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Mother"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Footloose"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Teenage Mutant Ninja Turtles"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"The Crazies"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Crossroads"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Les Misérables"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"The Green Hornet"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Fantastic Four"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"A Nightmare on Elm Street"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Beauty and the Beast"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"The Kid"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Red Dawn"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Nobody's Fool"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"The Last House on the Left"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Mother Knows Best"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"The Addams Family"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Dawn of the Dead"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Pet Sematary"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"The Heartbreak Kid"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Emma"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"The Animal"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"The Omen"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"My Little Pony: The Movie"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"A Christmas Carol"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"The Island"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Ghostbusters"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Project X"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"The Fog"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Vacation"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Gladiator"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"The Island of Dr. Moreau"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Hellboy"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"Sahara"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"King Kong"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"The Player"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Billy Boy"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"The Mummy"</td>
<td>2</td>
</tr>
<tr class="even">
<td>"Arthur"</td>
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>